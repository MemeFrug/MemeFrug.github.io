const GameName="StoryGameLevelCreator",Game=new _(GameName),player=new Player(Game,!1,0,0,50,50,100,300,-300,0),world=new World(levelData,Game),SaveNameInput=document.getElementById("NameOfSaveInput"),LocalSaveButton=document.getElementById("SaveLocallyButton"),LoadSaveButton=document.getElementById("LoadSaveButton"),DownloadButton=document.getElementById("DownloadSaveButton");let LocalSaveLevels=[],Drawing=!1,Deleting=!1,AlreadyLoaded=!1;player.c="red",player.gravityMax=0,player.DisableCollision(),player._Move=e=>{switch(e){case"w":player.vy=-player.speed;break;case"a":player.vx=-player.speed;break;case"d":player.vx=player.speed;break;case"s":player.vy=player.speed}},player._stopMoving=e=>{switch(e){case"w":case"s":player.vy=0;break;case"a":case"d":player.vx=0}},Game.Config.sideScroller=!0,Game.Config.boundries.left=0,Game.Config.boundries.right=Game.Config.WorldSize.x-player.w,Game.Config.sideScrollerSideOffset=0,Game.addPlayer(player,!0),Game._Init();const music=new Audio("../StoryGame/Assets/Audio/masterpiece.mp3");function stopMusic(){music.pause()}function startMusic(){music.play()}function download(e,a){var l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(a)),l.setAttribute("download",e),document.body.appendChild(l),l.click(),document.body.removeChild(l)}music.autoplay=!0,music.loop=!0,console.log("Test"),window.addEventListener("contextmenu",(e=>{e.preventDefault()})),window.addEventListener("mouseup",(e=>{e.preventDefault(),(0==e.button||2==e.button)&&(Drawing=!1,Deleting=!1)})),window.addEventListener("mousedown",(e=>{0==e.button?(Drawing=!0,Deleting=!1):2==e.button&&(e.preventDefault(),Drawing=!1,Deleting=!0)})),window.addEventListener("Game:BeforeDrawLoop",(()=>{const e=Game.canvas.getMousePosition(),a=Game.canvas.ctx;let l=0,o=1;for(let t=0;t<levelData.length;t++){l=0;for(let n=0;n<levelData[t].length;n++){if(_rectIntersect(e.x,e.y,0,0,l,o,50,50))if(a.globalAlpha=.4,a.fillRect(l,o,50,50),a.globalAlpha=1,Drawing){let e=new Square(Game,!0,l,o,50,50);levelData[t][n]=1,world.setTile({i:t,j:n},e)}else Deleting&&(levelData[t][n]=0,world.deleteTile({i:t,j:n}));a.strokeRect(l,o,50,50),l+=50}o+=50}})),window.addEventListener("Game:AfterDrawLoop",(()=>{const e=Game.canvas.getMousePosition();Game.canvas.ctx.fillRect(e.x-7.5,e.y-7.5,15,15)})),LocalSaveButton.addEventListener("mousedown",(e=>{const a=SaveNameInput.value,l=localStorage.getItem(GameName+"Levels");if(console.log("Inputed Name: ",a),a&&""!=a)if(l){let e,o=!1;console.log("Found Save File"),LocalSaveLevels=JSON.parse(l);for(let l=0;l<LocalSaveLevels.length;l++){LocalSaveLevels[l].name==a&&(o=!0,e=l)}o?(console.log(LocalSaveLevels[e]),LocalSaveLevels[e].data=levelData,localStorage.setItem(GameName+"Levels",JSON.stringify(LocalSaveLevels))):(LocalSaveLevels.push({name:a,data:levelData}),localStorage.setItem(GameName+"Levels",JSON.stringify(LocalSaveLevels)))}else console.log("Creating Save"),LocalSaveLevels.push({name:a,data:levelData}),localStorage.setItem(GameName+"Levels",JSON.stringify(LocalSaveLevels));else console.error("Level Name Cant Be Nothing")})),LoadSaveButton.addEventListener("mousedown",(e=>{if(AlreadyLoaded)console.error("Already Loaded A Save, Cannot Anymore please refresh the page"),alert("Already Loaded A Save, Cannot Anymore please refresh the page");else{const e=SaveNameInput.value,a=JSON.parse(localStorage.getItem(GameName+"Levels"));console.log(a),a&&(LocalSaveStorage=a,LocalSaveStorage.forEach((a=>{if(a.name==e)return AlreadyLoaded=!0,levelData=a.data,console.log(levelData),world.regen(levelData),void console.log("Found Save File")})),AlreadyLoaded||(console.error("Could Not Find That Save File Locally"),alert("Could Not Find That Save File Locally")))}})),DownloadButton.addEventListener("mousedown",(()=>{const e=SaveNameInput.value;LocalSaveLevels&&(LocalSaveLevels.length>0?LocalSaveLevels.forEach((a=>{a.name==e&&(console.log("Found Level Name In Files, Downloading It"),download(e+".level",JSON.stringify(a.data)))})):(console.log("Downloading Current Scene"),download(e+".level",JSON.stringify(levelData))))})),document.addEventListener("dragenter",(e=>{const a=e.dataTransfer.types.includes("Files");console.log(e.dataTransfer.types),console.log(a),a&&e.preventDefault()})),document.addEventListener("dragover",(e=>{e.dataTransfer.types.includes("Files")&&e.preventDefault()})),document.addEventListener("drop",(e=>{if(e.preventDefault(),AlreadyLoaded)console.error("Already Loaded A Save, Cannot Anymore please refresh the page"),alert("Already Loaded A Save, Cannot Anymore please refresh the page");else{AlreadyLoaded=!0;var a=e.dataTransfer.files[0];if(a.name.includes(".level"))return reader=new FileReader,reader.onload=function(e){const l=a.name,o=e.target.result;SaveNameInput.value=l.replace(".level",""),levelData=JSON.parse(o),world.regen(levelData),console.log("Loaded World")},reader.readAsText(a),!1;console.error("File Is Not a .level")}}));
