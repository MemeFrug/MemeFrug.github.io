const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),cols=200,rows=200,Points=[];let mousePos={x:0,y:0},mouseHighlight={i:0,j:0};canvas.addEventListener("mousemove",(i=>{let e=canvas.getBoundingClientRect(),t=i.clientX-e.left-canvas.clientLeft,s=i.clientY-e.top-canvas.clientTop;mousePos={x:t,y:s};for(let i=0;i<200;i++)for(let e=0;e<200;e++){var n=5*i,c=5*e;const t=5;mousePos.x<=n+t&&mousePos.x>=n&&mousePos.y>=c&&mousePos.y<=c+t&&(mouseHighlight={i:i,j:e})}}));let DrawingWhat=0,Drawing=!1;function Draw(){0==DrawingWhat?(Points[mouseHighlight.i][mouseHighlight.j].Occupied=elements.sand,Points[mouseHighlight.i+1][mouseHighlight.j].Occupied=elements.sand,Points[mouseHighlight.i][mouseHighlight.j+1].Occupied=elements.sand,Points[mouseHighlight.i+1][mouseHighlight.j+1].Occupied=elements.sand,Points[mouseHighlight.i+2][mouseHighlight.j].Occupied=elements.sand,Points[mouseHighlight.i+3][mouseHighlight.j].Occupied=elements.sand,Points[mouseHighlight.i][mouseHighlight.j+3].Occupied=elements.sand,Points[mouseHighlight.i+4][mouseHighlight.j+1].Occupied=elements.sand):1==DrawingWhat&&(Points[mouseHighlight.i][mouseHighlight.j].Occupied=elements.water,Points[mouseHighlight.i+1][mouseHighlight.j].Occupied=elements.water,Points[mouseHighlight.i][mouseHighlight.j+1].Occupied=elements.water,Points[mouseHighlight.i+1][mouseHighlight.j+1].Occupied=elements.water)}canvas.addEventListener("mousedown",(i=>{Drawing=!0})),canvas.addEventListener("mouseup",(i=>{Drawing=!1}));let lastTime=0;function _Update(i){lastTime=i,ctx.clearRect(0,0,canvas.width,canvas.height),Drawing&&Draw();let e=[];for(let i=0;i<200;i++)for(let n=0;n<200;n++){var t=5*i,s=5*n;Points[i][n].UpdateCell(),i==mouseHighlight.i&&n==mouseHighlight.j&&ctx.fillRect(t,s,5,5),0==!Points[i][n].Occupied.id&&(2==Points[i][n].Occupied.id&&Points[i][n+1]&&(Points[i][n+1].Occupied.id==elements.void.id||Points[i][n+1].Occupied.id==elements.water.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i][n+1].Occupied;Points[i][n].Occupied=t,Points[i][n+1].Occupied=e})):Points[i-1]&&(Points[i-1][n+1].Occupied.id==elements.void.id||Points[i-1][n+1].Occupied.id==elements.water.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i-1][n+1].Occupied;Points[i][n].Occupied=t,Points[i-1][n+1].Occupied=e})):Points[i+1]&&(Points[i+1][n+1].Occupied.id!=elements.void.id&&Points[i+1][n+1].Occupied.id!=elements.water.id||e.push((()=>{let e=Points[i][n].Occupied,t=Points[i+1][n+1].Occupied;Points[i][n].Occupied=t,Points[i+1][n+1].Occupied=e}))))),4==Points[i][n].Occupied.id&&Points[i][n+1]&&(Points[i][n+1].Occupied.id==elements.void.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i][n+1].Occupied;Points[i][n].Occupied=t,Points[i][n+1].Occupied=e})):Points[i-1]&&(Points[i-1][n+1].Occupied.id==elements.void.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i-1][n+1].Occupied;Points[i][n].Occupied=t,Points[i-1][n+1].Occupied=e})):Points[i+1]&&(Points[i+1][n+1].Occupied.id==elements.void.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i+1][n+1].Occupied;Points[i][n].Occupied=t,Points[i+1][n+1].Occupied=e})):Points[i-1]&&(Points[i-1][n].Occupied.id==elements.void.id?e.push((()=>{let e=Points[i][n].Occupied,t=Points[i-1][n].Occupied;Points[i][n].Occupied=t,Points[i-1][n].Occupied=e})):Points[i+1]&&Points[i+1][n].Occupied.id==elements.void.id&&e.push((()=>{let e=Points[i][n].Occupied,t=Points[i+1][n].Occupied;Points[i][n].Occupied=t,Points[i+1][n].Occupied=e})))))),ctx.fillStyle=Points[i][n].c,ctx.fillRect(t,s,5,5))}e.forEach((i=>{i()})),requestAnimationFrame(_Update)}function _Init(){for(let i=0;i<200;i++){Points[i]=[];for(let e=0;e<200;e++)Points[i][e]=new Cell(elements.void)}_Update()}function CreateSand(){Points[10][1].Occupied=elements.sand,Points[10][2].Occupied=elements.sand}_Init();
